
<dom-module id="chpe-coupon">
    <style type="text/css">
        .submitButtons {
            text-align: right;
            margin: 0px 12px 0px 0px;
            padding: 0px;
        }
        
        .submitButtons span {
            display: inline-block;
        }
        .arrows{
            background: none;
        }
        .base-scheme-card{
            width: 50%;
            padding: 2%;
        }
        #cards {
          @apply(--layout-vertical);
          @apply(--center-justified);
          max-width:780px;
          margin-left: auto;
          margin-right: auto;
          padding: 10px;
        }
        paper-fab {
          display: block;
          margin-left: auto;
          margin-right: auto;
          border-radius: 50%;
          height: 40px;
          width: 40px;
        }
        paper-fab.blue {
          --paper-fab-background: var(--paper-light-blue-300);
          --paper-fab-keyboard-focus-background: var(--paper-light-blue-200);
        }
        paper-fab.red {
          --paper-fab-background: var(--paper-red-500);
          --paper-fab-keyboard-focus-background: var(--paper-red-900);
        }
        paper-fab.green {
          --paper-fab-background: var(--paper-green-500);
          --paper-fab-keyboard-focus-background: var(--paper-green-900);
        }
        paper-fab.orange {
          --paper-fab-background: var(--paper-orange-500);
          --paper-fab-keyboard-focus-background: var(--paper-orange-900);
        }
        .coupon-base-card{
            margin: 0px auto;
            max-width: 720px;
            @apply(--layout-vertical);
            @apply(--center-justified);
        }
        paper-input {
            margin-top: 0px !important;
            margin-left: 10px;
        }
        .coupon-extend-card{
            margin: 0px auto;
            max-width: 760px;
            @apply(--layout-vertical);
            @apply(--center-justified);
        }
        .leftnav {
            position: fixed;
            top:155px;
            left: 256px;
            z-index: 11;
            min-height: 160px;
        }
        
        .leftnav paper-item {
            cursor: pointer;
        }
        
        .leftnav .iron-selected {
            background: #4fc3f7 !important;
            border-radius: 0px;
        }
        .lastStepActions {
            padding: 0px;
            margin: 0px;
            /*background: #4fc3f7;*/
        }
        
    </style>
    <template>
       <paper-material class="leftnav">
            <paper-menu selected="{{selected}}" style="padding:0px;">
                <paper-item>1</paper-item>
                <paper-item>2</paper-item>
            </paper-menu>
        </paper-material>
        <paper-material elevation="1" type="{{schemeType}}">
            <form is="iron-form" id="coupon-form" method="POST" action="#">
                <neon-animated-pages id="pages" class="flex" selected="[[selected]]" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
                    <neon-animatable>
                        <div class="col-1">&nbsp;</div>
                        <div class="col-8">
                        <paper-card elevation="5" class="coupon-extend-card">
                        <div class="card-content margin0">
                            <basic-scheme id="basicScheme" start-date-modal="couponStartDate" end-date-modal="couponEndDate" scheme-starts="couponStart" scheme-ends="couponEnds" start-date-type="couponStart" end-date-type="couponEnds" sd-dp="stcDp" sd-tp="stcTp" ed-dp="eDcDp" ed-tp="eDcTp" flat-id="basicFlatInCoupon" percentage-id="basicPerecentageInCoupon" discount-value="{{defaultDiscount}}" >
                            </basic-scheme>
                         </div>
                        <div class="card-actions col-12" style="padding:0px;margin:0px;">
                          <div class="col-11 margin0">&nbsp;</div>
                          <div class="col-1 margin0">
                            <paper-fab mini icon="done" class="blue action" on-click="_onNextClick">
                            </paper-fab>
                          </div>
                        </div>
                    </paper-card>
                    </div>
                    </neon-animatable>

                    <!-- step2 -->
                    <neon-animatable>
                    <div class="col-1">&nbsp;</div>
                    <div class="col-8">
                    <paper-card elevation="5" class="coupon-extend-card">
                        <div class="card-content margin0">
                        <service-rate-category id="srcCatCoupon"></service-rate-category>
                         <div class="col-6">
                            <div class="col-12" style="margin:10px 0px 0px 0px;font-weight:bold;">
                                    <label style="margin-left:10px;">Locations :</label>
                                </div>
                                <div class="col-12 margin0">
                                <multi-value-suggestbox id="multi_suggest" newInput="" url="/api/proxy?url=http://52.76.37.144:8080/javaapi/rest/locations/"
                                options='{
                                "allow_space": false,
                                "allow_nonmatching": false}' 
                                selected-items="{{scheme.behavior.locationOfServices}}">
                                </multi-value-suggestbox>
                                </div>
                            </div>
                            <div class="col-6">
                              <coupon-type id="selectCouponType"></coupon-type>
                            </div>
                        </div>
                         <div class="card-actions col-12 lastStepActions">
                            <div class="arrows col-1 margin0">
                                <paper-fab mini icon="arrow-back" class="action" 
                                on-click="_onPrevClick">
                                </paper-fab>
                            </div>
                            <div class="col-5 margin0">&nbsp;</div>
                            <div class="col-6 margin0">
                                <div class="submitButtons">
                                    <paper-button name="coupon-form.createSchemeBtn" raised  on-click="submitForm" data-args="false" id="saveBtn"  value="{{schemeStatus}}">Save</paper-button>
                                    <paper-button name="coupon-form.createSchemeBtn" data-args="true" on-click="submitForm" id="publishBtn" status="true" raised value="{{schemeStatus}}">Save + Publish</paper-button>
                                </div>
                            </div>
                        </div>
                    </paper-card>
                    </div>
                    </neon-animatable>
                </neon-animated-pages>
            </form>
        </paper-material>
        <iron-ajax id="couponAjax" content-type="application/json" method="POST" params='{}' handle-as="json" on-error="handleError" on-response="handleResponse"></iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'chpe-coupon',
            properties: {
                schemeType: String,
                schemeStatus: Boolean,
                succErrMsg: String
            },
            attached: function() {
               // console.log(this.schemeType);
            },
            ready: function() {
                this.selected = 0;
                this.config = generalConfig() || {};
                this.scheme = schemeBase();
                this.$.basicScheme.metadata = this.scheme.metadata;
                this.$.basicScheme.behavior = this.scheme.behavior;
                this.$.srcCatCoupon.behavior = this.scheme.behavior;
                this.$.selectCouponType.metadata = this.scheme.metadata;
            },
            listeners: {
                'coupon-form.iron-form-submit': 'createScheme',
                'coupon-form.saveBtn.onClick': 'submitForm',
                'value-change':'getCurrentStep',
                'coupon-form.iron-input-validate':'enableButtons'
            },
            
            enableButtons:function(e){
                /*if(e.target.invalid){
                    document.querySelector("#firstStep").hidden = true;
                }else{
                    document.querySelector("#firstStep").hidden = false;
                }
                console.log(e.target.invalid);*/
            },
            //neon animations for coupon
            _onPrevClick: function() {
                this.entryAnimation = 'slide-from-left-animation';
                this.exitAnimation = 'slide-right-animation';
                this.selected = this.selected === 0 ? 4 : (this.selected - 1);
               // var setps = document.querySelector('#stepIndicator');
                //setps.value  = this.selected;
            },
            _onNextClick: function() {
                this.entryAnimation = 'slide-from-right-animation';
                this.exitAnimation = 'slide-left-animation';
                this.selected = this.selected === 4 ? 0 : (this.selected + 1);
                //var setps = document.querySelector('#stepIndicator');
                //setps.value  = this.selected;
            },
            createScheme: function() {
                this.formData = document.getElementById('coupon-form').serialize();
                this.scheme.behavior.startDate = chUtils.toIsoString(this.formData.couponStart);
                this.scheme.behavior.endDate = chUtils.toIsoString(this.formData.couponEnds);

                this.scheme.metadata.type = "COUPON";
                this.scheme.metadata.published = false;
                this.scheme.on = "newscheme";
                this.scheme.operation = "create";
                if (this.scheme !== undefined) {
                    this.$.couponAjax.url='http://172.19.4.162:91'+this.config.urls.rest;
                    this.$.couponAjax.method = "POST";
                    this.$.couponAjax.body = JSON.stringify(this.scheme);
                    this.$.couponAjax.generateRequest();
                }
            },
            handleResponse: function(event) {
                if(event.detail.response!=null && event.detail.response!==undefined){
                    document.querySelector("#schemeSuccErrMessageToast").show();
                    console.log("Received response: " + JSON.stringify(event.detail.response));
                    var toast = document.querySelector("#schemeSuccErrMessageToast");
                    toast.text =  this.scheme.metadata.type+" created successfully!...";
                    toast.show();
                }else{
                    console.log(this.scheme);
                    document.querySelector("#schemeSuccErrMessageToast").show();
                    var toast = document.querySelector("#schemeSuccErrMessageToast");
                    toast.text =  "Error while creating" + this.scheme.metadata.type;
                }
                setTimeout(function() {
                    //this.formData.clear();
                },2000);
            },
            handleError: function(event) {
                var request = event.detail.request;
                var error = event.detail.error;
                console.log(error);
                var toast = document.querySelector("#schemeSuccErrMessageToast");
                toast.text = "Error while creating " + this.scheme.metadata.type+" Please try again.. ";
                toast.show();
            },
            submitForm: function(evt, details, sender) {
                document.getElementById('coupon-form').submit();
            }
        });
    </script>
</dom-module>