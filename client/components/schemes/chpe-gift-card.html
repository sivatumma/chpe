<script src="../../config/general.js"></script>
<script src="../../config/schemeBase.js"></script>
<dom-module id="chpe-gift-card">
<style type="text/css">
    .submitButtons{
        text-align: right;
    }
    .submitButtons span{
        display: inline-block;
    }
    .arrows{
            background: none;
    }
    .base-scheme-card{
        width: 50%;
        padding: 2%;
    }
    #cards {
      @apply(--layout-vertical);
      @apply(--center-justified);
      max-width:780px;
      margin-left: auto;
      margin-right: auto;
      padding: 10px;
    }
    paper-fab {
      display: block;
      margin-left: auto;
      margin-right: auto;
      border-radius: 50%;
      height: 40px;
      width: 40px;
    }
    paper-fab.blue {
      --paper-fab-background: var(--paper-light-blue-300);
      --paper-fab-keyboard-focus-background: var(--paper-light-blue-200);
    }
    paper-fab.red {
      --paper-fab-background: var(--paper-red-500);
      --paper-fab-keyboard-focus-background: var(--paper-red-900);
    }
    paper-fab.green {
      --paper-fab-background: var(--paper-green-500);
      --paper-fab-keyboard-focus-background: var(--paper-green-900);
    }
    paper-fab.orange {
      --paper-fab-background: var(--paper-orange-500);
      --paper-fab-keyboard-focus-background: var(--paper-orange-900);
    }
    .giftCard-base-card{
        margin: 0px auto;
        max-width: 720px;
        @apply(--layout-vertical);
        @apply(--center-justified);
    }
    .arrows paper-icon-button{
        margin-bottom: 0px !important;
    }
</style>
    <template>
        <paper-material elevation="1" type="{{schemeType}}">
      		<!-- <h4 class="paper-font-display2" type="{{schemeType}}">Create Scheme <span>{{schemeType}}</span></h4> -->
            <form is="iron-form" id="gift-card-form" method="POST" action="#">
                <neon-animated-pages id="addonPages" class="flex" selected="[[selected]]" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
                    <neon-animatable>
                        <paper-card elevation="1" class="giftCard-base-card">    
	                       <basic-scheme start-date-modal="giftCardStartDate" end-date-modal="giftCardEndDate" scheme-starts="giftCardStart" scheme-ends="giftCardEnds" start-date-type"gcsd" end-date-type="gced" sd-dp="stgcDp" sd-tp="stgcTp" ed-dp="eDgcDp"  ed-tp="eDgcTp" flat-id="basicFlatInGiftCard" percentage-id="basicPerecentageInGiftCard">
                           </basic-scheme>
                        </paper-card>
                        <div align="center" class="arrows">
                            <paper-fab icon="arrow-forward"  class="blue" on-click="_onNextClick"></paper-fab>
                        </div>
                    </neon-animatable>
                    <neon-animatable>
                        <div align="center" class="arrows">
                            <paper-fab icon="arrow-back" class="blue" on-click="_onPrevClick">
                            </paper-fab>
                        </div>    
                        <div class="submitButtons">
                            <span>
                                <paper-button name="createSchemeBtn" raised  on-click="submitForm" data-args="false" id="saveBtn"  value="{{schemeStatus}}">Save</paper-input>
                            </span>
                            <span>
                                <paper-button name="createSchemeBtn" data-args="true" on-click="submitForm" id="publishBtn" status="true" raised value="{{schemeStatus}}">Save + Publish</paper-input>
                            </span>
                        </div>
                    </neon-animatable>
                </neon-animated-pages>   
			</form>
        </paper-material>
         <iron-ajax  id="giftCardAjax" content-type="application/json"  method="POST" params='{}'   
         handle-as="json" on-error="handleError" on-response="handleResponse" ></iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'chpe-gift-card',
            properties: {
                schemeType: String,
                schemeStatus:Boolean,
                succErrMsg:String
            },
            attached:function(){
                console.log(this.schemeType);
            },
            ready:function(){
                this.config = generalConfig() || {};
                this.metadata = schemeBase().metadata;
                this.behavior = schemeBase().behavior;
                this.scheme =  schemeBase() || editSchemeObj;
                this.selected = 0;
            },
            listeners:{
              'gift-card-form.iron-form-submit':'createScheme',
              'saveBtn.onClick':'submitForm',
            },
            _onPrevClick: function() {
                this.entryAnimation = 'slide-from-left-animation';
                this.exitAnimation = 'slide-right-animation';
                this.selected = this.selected === 0 ? 4 : (this.selected - 1);
            },
            _onNextClick: function() {
                this.entryAnimation = 'slide-from-right-animation';
                this.exitAnimation = 'slide-left-animation';
                this.selected = this.selected === 4 ? 0 : (this.selected + 1);
            },
            createScheme:function(){
                 this.formData = document.getElementById('gift-card-form').serialize();

                 this.scheme.behavior.startDate = chUtils.toIsoString(this.formData.startDate);
                 this.scheme.behavior.endDate = chUtils.toIsoString(this.formData.endDate);

                 this.metadata.type = "GIFT_CARD";
                 this.metadata.published = this.schemeStatus || this.metadata.published;
                 this.scheme.on  = "newscheme";
                 this.scheme.operation = "create";
                 console.log(this.scheme);
                 if(this.scheme!== undefined){
                     this.config.urls.apiHost+'/api/pricingengine'+this.config.urls.rest;
                     this.$.giftCardAjax.method = "POST";
                     this.$.giftCardAjax.body = JSON.stringify(this.scheme);
                     this.$.giftCardAjax.generateRequest();
                 }
            },
            handleResponse:function(event){
                console.log(event.detail.response);
                document.querySelector("#schemeSuccErrMessageToast").show();
                console.log("Received response: " + JSON.stringify(response.detail.response));
                setTimeout(function(){

                },3000);
            },
            handleError:function(event){
                var request=event.detail.request;
                console.log(event);
                var error=event.detail.error;
                var toast=document.querySelector("#schemeSuccErrMessageToast");
                toast.text= "Error while creating "+this.scheme.metadata.type+" Please try again.. ";
                toast.show();
            },
            submitForm:function(evt,details,sender){
                document.getElementById('gift-card-form').submit();
            }
        });
       
        
    </script>
</dom-module>