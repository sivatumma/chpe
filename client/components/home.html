<script src="../config/general.js"></script>

<dom-module id="schemes-as-cards">
<style type="text/css">

  :host{
    float:left;
    padding:10px;
    text-align:center;
    width:99%;
}

	.cards {
      @apply(--layout-vertical);
      @apply(--center-justified);
      margin-top:30px;
      font-size: 16px;
    }
    paper-card {
      display: block;
	    /*width: calc(33% - 90px);*/
      width:230px;
      height:200px;
	    margin: 10px 5px 10px 10px;
	    cursor: pointer;
	    transition: box-shadow 0.1s;
	    float: left;
    }
    .avatar {
      display: inline-block;
      height: 64px;
      width: 64px;
      border-radius: 50%;
      background: var(--paper-pink-500);
      color: white;
      line-height: 64px;
      font-size: 30px;
      text-align: center;
    }
    .fancy .title {
      position: absolute;
      top: 30px;
      left: 100px;
      color: var(--paper-indigo-500);
    }
    .fancy img {
      width: 100%;
    }
    .fancy .big {
      font-size: 22px;
      padding: 8px 0 16px;
      color: var(--google-grey-500);
    }
    .fancy .medium {
      font-size: 16px;
      padding-bottom: 8px;
    }
    .pink {
      --paper-card-header-color: var(--paper-pink-500);
    }
    paper-card .header{
    	font-size: 16px !important;
    }
</style>
<template>
	<paper-material>
		<template is="dom-repeat" items="{{allSchemes}}"> 
			<paper-card elevation="2" heading="{{item.metadata.type}}" class="cards" id="{{getId(index)}}" on-focus-out="toggleStyle" on-click="toggleStyle">
				<div class="card-content">{{item.metadata.name}}</div>
				<div class="card-actions">
        <link-icon icon-type="link" icon-links='[{"route":"users"},{"route":"info"},{"route":"test"}]'></link-icon>
        <link-icon icon-type="social:share" icon-links='[{"route":"users"},{"route":"info"},{"route":"test"}]'></link-icon>
        <link-icon icon-type="face" icon-links='[{"route":"users"},{"route":"info"},{"route":"test"}]'></link-icon>
        <link-icon icon-type="visibility" icon-links='[{"route":"users"},{"route":"info"},{"route":"test"}]'></link-icon>
        <link-icon icon-type="settings" icon-links='[{"route":"users"},{"route":"info"},{"route":"test"}]'></link-icon>
				</div>
			</paper-card>
		</template>
    </paper-material>
    <iron-ajax  id="fetchSchemes" content-type="application/json"  method="POST" params='{}'   
         handle-as="json" on-error="handleError" on-response="handleResponse" ></iron-ajax>
</template>
<script>
  Polymer({
    is: 'schemes-as-cards',
    properties: {
      allSchemes: Object,
      scheme: Object,
      previouslySelectedId:String
    },
    listeners: {
      "onClick":"toggleStyle",
      "onFocusOut":"toggleStyle"
    },
    ready: function() {
      console.log("Hi Schemes as cards loaded....!");
      this.scheme = {
        "on": "newscheme",
        "operation": "find"
      };
      this.$.fetchSchemes.url = generalConfig().urls.rest;
      this.$.fetchSchemes.method = "GET";
      this.$.fetchSchemes.body = JSON.stringify(this.scheme);
      this.$.fetchSchemes.generateRequest();
    },
    getId: function(index){
      return "r_" + index;
    },
    toggleStyle: function(event) {
      console.log(event);
      if(this.previouslySelectedId != null){
        document.querySelector(this.previouslySelectedId).style.background = '#fff';
        document.querySelector(this.previouslySelectedId).style.color = '#000';
      }
      document.querySelector('#r_'+event.model.index).style.background = 'lightblue';
      document.querySelector('#r_'+event.model.index).style.color = '#000';
      this.previouslySelectedId = '#r_'+event.model.index;
    },
    handleResponse: function(event) {
      console.log(event.detail.response);
      var data = event.detail.response;
      if (data !== undefined && data != null) {
        this.allSchemes = data;
      } else {
        this.allSchemes = [{}];
      }
    },
    handleError: function(event) {
      var request = event.detail.request;
      console.log(event);
      var error = event.detail.error;
      console.log(event.detail.response);
    }

  });
</script>
</dom-module>

